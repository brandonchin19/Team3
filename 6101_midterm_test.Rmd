---
title: "DATS 6101 Midterm"
authors: "Brandon Chin, Paul Kelly, Ksenia Shadrina, Luke Wu"
date: "2/16/22"
# date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "show", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

### Research Topic:

There is considerable evidence indicating lending disparities throughout the United States. (Steil et. al: 2018). For our research topic, we will explore lending practices in one of the fastest appreciating real estate markets over the past thirty years - the state of California. Specifically, we aim to look at the factors that are associated with denials for non-commercial mortgage loans.

Our SMART question is:

“Which factors drove denials for mortgages in California in 2019?”

To answer this question, we are using the Federal Financial Institutions Examination Council's (FFIEC) Home Mortgage Disclosure Act (HMDA) dataset from 2019, located here: https://ffiec.cfpb.gov/data-publication/dynamic-national-loan-level-dataset/2019. We are  focusing on a subset of data of 10,000 observations from 2019 that we will further filter on California leaving us with 5,196 observations.

Our Github repository address is:https://github.com/brandonchin19/Team3/.

### Load in dataset

```{r}
hmda <- data.frame(read.csv("2019_lar.csv"))
str(hmda)
```

# Check number of rows

```{r}
nrow(hmda)
```


# Check head and tail of dataframe

```{r}
xkabledplyhead(hmda,5)
xkabledplytail(hmda,5)
```

# Subsetting to California Only

```{r}
hmda_ca <- subset(hmda,state_code=="CA")
str(hmda_ca)
```

# Subsetting to California Only; non-business properties; principal residences only

```{r}
hmda_ca <- subset(hmda_ca,business_or_commercial_purpose=="2")
str(hmda_ca)
```


```{r}
hmda_ca <- subset(hmda_ca,occupancy_type=="1")
str(hmda_ca)
```

# Subsetting to only relevant columns

```{r}
hmda_ca_final <- hmda_ca[c(10,11,12,13,22,24,39,46,78)]
str(hmda_ca_final)
```

# Changing vector types

```{r}
hmda_ca_final[, 'applicant_sex'] <- as.factor(hmda_ca_cleaned_1[, 'applicant_sex'])
str(hmda_ca_cleaned_1)
```

```{r}
hmda_ca_final_1 = hmda_ca_final
hmda_ca_final_1$derived_ethicity = factor(hmda_ca_final$derived_ethicity)
hmda_ca_final_1$derived_race = factor(hmda_ca_final$derived_race)
hmda_ca_final_1$derived_sex = factor(hmda_ca_final$derived_sex)
hmda_ca_final_1$action_taken = factor(hmda_ca_final$action_taken)
hmda_ca_final_1$loan_amount = as.numeric(hmda_ca_final$loan_amount)
hmda_ca_final_1$interest_rate = as.numeric(hmda_ca_final$interest_rate)
hmda_ca_final_1$property_value = as.numeric(hmda_ca_final$property_value)
hmda_ca_final_1$income = as.numeric(hmda_ca_final$income)
hmda_ca_final_1$applicant_age = factor(hmda_ca_final$applicant_age)
str(hmda_ca_final_1)
```

# Exploring columns that appear to have lots of NAs

```{r}
summary(hmda_ca_final$interest_rate)
```

```{r}
hmda_ca_final_no_outliers <- outlierKD2(hmda_ca_final,interest_rate)
```

# Boxplots

```{r}
ggplot(hmda_ca_cleaned,aes(x=applicant_sex))+
  geom_boxplot(color="black", fill="purple")+
  labs(title="Boxplot of Applicant Sex", x="Applicant Sex", y="Frequency")
```

The results of this look pretty weird. What are values 3, 4, and 6? 3 = not provided, 4 = not applicable, 6 = applicant selected both male (1) and female (2). We should remove 3, 4, and 6 or create a subset of only 1 and 2, then turn 1 and 2 into factors?

# Removing sex values above "2"

Change this to derived_sex 

```{r}
hmda_ca_cleaned_1 <- subset(hmda_ca_cleaned,applicant_sex<3)
```

# Change applicant_sex vector to factor (expand this to other field that should be factorized)

```{r}
hmda_ca_cleaned_1[, 'applicant_sex'] <- as.factor(hmda_ca_cleaned_1[, 'applicant_sex'])
str(hmda_ca_cleaned_1)
```
